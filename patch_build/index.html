<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AI NPC Game (Modular)</title>
<style>
  :root{ --bg:#0b0d10; --panel:#12161b; --muted:#9aa5b1; --text:#e6eef7; --accent:#67c1f5; }
  body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:var(--text)}
  header{display:flex;gap:.75rem;align-items:center;padding:.75rem 1rem;border-bottom:1px solid #1b222b;position:sticky;top:0;background:#0b0d10}
  .pill{padding:.25rem .5rem;border-radius:999px;background:#0f141a;border:1px solid #1d2631;color:var(--muted);font-size:.85rem}
  .layout{display:grid;grid-template-columns:260px 1fr 360px;gap:12px;padding:12px}
  .card{background:var(--panel);border:1px solid #1b222b;border-radius:14px;overflow:hidden}
  .card h2{font-size:1rem;margin:0;padding:.8rem .9rem;border-bottom:1px solid #1b222b}
  .card .body{padding:.9rem}
  .row{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}
  button,input,textarea{background:#0f141a;border:1px solid #2a3441;color:var(--text);border-radius:10px;padding:.55rem .7rem;font:inherit}
  button{background:#18212b;cursor:pointer} button:hover{background:#1d2733}
</style>
</head>
<body>
  <header>
    <h1 style="font-size:1rem;margin:0;">AI NPC Game (Modular)</h1>
    <span class="pill">Location: <span id="loc">—</span></span>
    <span class="pill">Day: <span id="day">1</span></span>
    <span class="pill">Time: <span id="time">morning</span></span>
    <span class="pill">Money: <span id="money">$50</span></span>
    <span style="margin-left:auto"></span>
    <button id="advance">Advance Time</button>
    <button id="openSettings">Settings</button>
  </header>

  <main class="layout">
    <aside class="card"><h2>Menu</h2><div class="body">
      <div class="row" style="gap:.4rem;">
        <button id="openKnown">Known (<span id="knownCount">0</span>)</button>
      </div>
      <div class="row" style="gap:.4rem;margin-top:.5rem;">
        <button id="openSettings2">Open Settings</button>
      </div>
    </div></aside>

    <section class="card"><h2>World</h2><div class="body">
      <div id="mapMedia"><img id="locationImage" style="width:100%;height:220px;object-fit:cover;border:1px solid #1b222b;border-radius:10px;display:none"/></div>
      <div id="locationDesc"><b>No world loaded yet.</b><br/>Open <i>Settings → World & Characters</i> to load your JSON.</div>
      <div style="height:1px;background:#1b222b;margin:.8rem 0"></div>
      <div class="row small" style="opacity:.8">Who&apos;s here</div>
      <div id="presence" class="small">—</div>
      <div id="hereNPCs" style="display:flex;flex-direction:column;gap:.5rem;margin-top:.4rem;"></div>
    </div></section>

    <aside class="card"><h2>Bag & Data</h2><div class="body">
      <div class="row"><input id="newItem" placeholder="Add item"/><button id="addItem">Add</button></div>
      <div id="inv"></div>
      <div style="height:1px;background:#1b222b;margin:.8rem 0"></div>
      <div class="row"><input id="moneyDelta" type="number" step="1" placeholder="±$" style="width:90px"/><button id="applyMoney">Apply</button></div>
    </div></aside>
  </main>

  <!-- Settings Modal (world/characters/chub.ai import) -->
  <div id="settingsModal" class="modal-overlay" aria-hidden="true" style="position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:2000">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle" style="width:min(720px,95vw);background:#12161b;border:1px solid #1b222b;border-radius:14px;overflow:hidden">
      <header style="display:flex;align-items:center;gap:.6rem;padding:.7rem .9rem;border-bottom:1px solid #1b222b;background:#0f141a">
        <h3 id="settingsTitle" style="margin:0;font-size:.98rem">Settings</h3>
        <span style="margin-left:auto"></span>
        <button class="close" id="settingsCloseBtn" title="Close" style="margin-left:auto;background:#222;border:1px solid #2a3441;border-radius:8px;padding:.25rem .5rem;cursor:pointer">×</button>
      </header>
      <div class="body" style="padding:.9rem">
        <label class="small">LLM API Key
          <input id="apiKey" type="text" placeholder="Paste key…" style="width:100%"/>
        </label>

        <div style="height:1px;background:#1b222b;margin:.8rem 0"></div>

        <h3 class="small" style="margin:.25rem 0 .5rem 0;">World & Characters</h3>
        <div class="row" style="gap:.75rem; flex-wrap:wrap">
          <label class="btn-ghost" for="mapFile">Load map.json</label>
          <input id="mapFile" type="file" accept="application/json" style="display:none"/>

          <label class="btn-ghost" for="charsFile">Load characters.json</label>
          <input id="charsFile" type="file" accept="application/json" style="display:none"/>

          <label class="btn-ghost" for="chubFile">Load chub.ai character.json</label>
          <input id="chubFile" type="file" accept="application/json" style="display:none"/>
        </div>
        <p class="small" id="dataStatus" style="opacity:.8;margin:.25rem 0 0 0;">
          Using: <span id="worldSource">none</span> · <span id="charsSource">none</span>
        </p>
      </div>
    </div>
  </div>

<link rel="icon" href="data:," />
<script src="./src/cosmos.js"></script>
<script type="module" src="./src/main.js?v=21"></script>
</body></html>
